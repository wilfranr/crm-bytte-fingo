<p-toast />
<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <p-button
      label="Nuevo Usuario"
      icon="pi pi-plus"
      severity="secondary"
      class="mr-2"
      (onClick)="openNew()"
    />
    <!-- <p-button -->
    <!--   label="Generar Token" -->
    <!--   icon="pi pi-link" -->
    <!--   severity="info" -->
    <!--   class="mr-2" -->
    <!--   (onClick)="generateToken()" -->
    <!--   *ngIf="isAdmin" -->
    <!-- /> -->
    <p-button
      severity="secondary"
      label="Eliminar"
      icon="pi pi-trash"
      outlined
      (onClick)="deleteSelectedUsers()"
      [disabled]="!selectedUsers || !selectedUsers.length"
    />
  </ng-template>
</p-toolbar>

<div *ngIf="inviteToken" class="mb-4">
  <p-message
    severity="info"
    text="Token generado: {{ inviteToken }}"
  ></p-message>
  <p-button
    label="Copiar Token"
    icon="pi pi-copy"
    severity="info"
    class="ml-2"
    (onClick)="copyToken()"
  ></p-button>
</div>

<p-table
  #dt
  [value]="users"
  [(selection)]="selectedUsers"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[5, 10, 20]"
  [tableStyle]="{ 'min-width': '65rem' }"
  [rowHover]="true"
  responsiveLayout="scroll"
  [globalFilterFields]="['name', 'email', 'role']"
  currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} usuarios"
  [showCurrentPageReport]="true"
>
  <ng-template #caption>
    <div class="flex items-center justify-between">
      <h5 class="m-0">Administrar Usuarios</h5>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 3rem"><p-tableHeaderCheckbox /></th>
      <th>Nombre</th>
      <th>Email</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-user>
    <tr>
      <td style="width: 3rem">
        <p-tableCheckbox [value]="user" />
      </td>
      <td>{{ user.name }}</td>
      <td>{{ user.email }}</td>
      <td>
        <span class="capitalize">{{ user.role }}</span>
      </td>
      <td>
        <p-button
          icon="pi pi-pencil"
          class="mr-2"
          [rounded]="true"
          [outlined]="true"
          (click)="editUser(user)"
        />
        <p-button
          icon="pi pi-trash"
          severity="danger"
          [rounded]="true"
          [outlined]="true"
          (click)="deleteUser(user)"
        />
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="userEditDialog"
  [style]="{ width: '400px' }"
  header="Detalles del Usuario"
  [modal]="true"
>
  <ng-template #content>
    <div class="flex flex-col gap-6">

      <div>
        <label class="block font-bold mb-3">Nombre</label>
        <input
          type="text"
          pInputText
          [(ngModel)]="user.name"
          required
          autofocus
          fluid
        />
      </div>
      <div>
        <label class="block font-bold mb-3">Email</label>
        <input
          type="email"
          pInputText
          [(ngModel)]="user.email"
          required
          fluid
        />
      </div>
      <div>
      <label for="role" class="block text-sm font-semibold text-white mb-1">Rol</label>
      <p-dropdown
        [(ngModel)]="user.role"
        [options]="roles"
        optionLabel="name"
        optionValue="value"
        placeholder="Selecciona un rol"
        appendTo="body"
        class="w-full">
      </p-dropdown>

      </div>
      <!-- <p-button -->
      <!-- label="Generar Token" -->
      <!-- icon="pi pi-link" -->
      <!-- severity="info" -->
      <!-- class="mr-2" -->
      <!-- (onClick)="generateToken()" -->
      <!-- *ngIf="isAdmin" -->
      <!-- /> -->

    </div>
  </ng-template>
  <ng-template #footer>
    <p-button label="Cancelar" icon="pi pi-times" text (click)="hideDialog()" />
    <p-button
      label="Guardar"
      icon="pi pi-check"
      severity="primary"
      (click)="saveUser()"
      [disabled]="!user.name || !user.email || !user.role"
      />
  </ng-template>
</p-dialog>


<p-dialog
  [(visible)]="userDialog"
  [style]="{ width: '400px' }"
  header="Detalles del Usuario"
  [modal]="true"
>
  <ng-template #content>
    <div class="flex flex-col gap-6">

      <!-- <div> -->
      <!--   <label class="block font-bold mb-3">Nombre</label> -->
      <!--   <input -->
      <!--     type="text" -->
      <!--     pInputText -->
      <!--     [(ngModel)]="user.name" -->
      <!--     required -->
      <!--     autofocus -->
      <!--     fluid -->
      <!--   /> -->
      <!-- </div> -->
      <!-- <div> -->
      <!--   <label class="block font-bold mb-3">Email</label> -->
      <!--   <input -->
      <!--     type="email" -->
      <!--     pInputText -->
      <!--     [(ngModel)]="user.email" -->
      <!--     required -->
      <!--     fluid -->
      <!--   /> -->
      <!-- </div> -->
      <div>
      <label for="role" class="block text-sm font-semibold text-white mb-1">Rol</label>
      <p-dropdown
        [(ngModel)]="user.role"
        [options]="roles"
        optionLabel="name"
        optionValue="value"
        placeholder="Selecciona un rol"
        appendTo="body"
        class="w-full">
      </p-dropdown>

      </div>
      <p-button
      label="Generar Token"
      icon="pi pi-link"
      severity="info"
      class="mr-2"
      (onClick)="generateToken()"
      *ngIf="isAdmin"
      />

    </div>
  </ng-template>
  <ng-template #footer>
    <p-button label="Cancelar" icon="pi pi-times" text (click)="hideDialog()" />
    <p-button
      label="Guardar"
      icon="pi pi-check"
      severity="primary"
      (click)="saveUser()"
      [disabled]="!user.name || !user.email || !user.role"
      />
  </ng-template>
</p-dialog>

<p-confirmdialog [style]="{ width: '400px' }" />
